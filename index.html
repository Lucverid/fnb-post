<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>F&B POS — Multi Gudang Final</title>

  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#6a00ff" />

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lucide-static@latest/font/lucide.css">
  
  <link rel="stylesheet" href="style.css?v=8">

  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker
          .register('./service-worker.js')
          .then(reg => console.log('SW registered', reg.scope))
          .catch(err => console.error('SW registration failed', err));
      });
    }
  </script>
</head>

<body>
  <div id="toast-container"></div>

  <div id="auth-card" class="auth-card">
    <div class="auth-box">
      <h2>Login</h2>
      <label>Email</label>
      <input id="loginEmail" type="email">
      <label>Password</label>
      <input id="loginPassword" type="password">
      <button id="btnLogin" class="btn-primary" type="button">Login</button>
      <hr>
      <h2>Register</h2>
      <label>Email</label>
      <input id="registerEmail" type="email">
      <label>Password</label>
      <input id="registerPassword" type="password">
      <label>Role</label>
      <select id="registerRole">
        <option value="admin">Admin</option>
        <option value="kasir">Kasir</option>
      </select>
      <button id="btnRegister" class="btn-secondary" type="button">Daftar Baru</button>
    </div>
  </div>

  <div id="app-shell" class="app-shell hidden">
    
    <header class="app-header glass">
      <div class="header-left">
        <div class="logo">F&amp;B</div>
        <div class="user-info">
          <div id="topbarEmail">–</div>
          <div id="connectionStatus" class="connection">Offline</div>
        </div>
      </div>
      <div class="header-right">
        <div id="notifBtn" class="notif-btn">
          <i class="lucide-bell"></i>
          <span id="notifBadge" class="notif-count">0</span>
        </div>
        <div id="notifPanel" class="notif-panel hidden">
          <div class="notif-title">Notifikasi</div>
          <ul id="notifList"></ul>
        </div>
        <button id="burgerBtn" class="burger-btn" type="button">
          <span></span><span></span><span></span>
        </button>
      </div>
    </header>

    <aside id="sidebar" class="sidebar">
      <nav>
        <div class="sidebar-group">
          <div style="margin:10px 0 6px; font-size:12px; opacity:.7;">WAREHOUSE</div>
          <button id="navWhDashboard" class="side-item active" type="button">
            <i class="lucide-layout-dashboard"></i> <span>Dashboard</span>
          </button>
          <button id="navWhOpname" class="side-item" type="button">
            <i class="lucide-arrow-right-left"></i> <span>Stok & Transfer</span>
          </button>
          <button id="navWhWaste" class="side-item" type="button">
            <i class="lucide-trash-2"></i> <span>Input Waste</span>
          </button>
          <button id="navWhReport" class="side-item" type="button">
            <i class="lucide-file-text"></i> <span>Laporan Pusat</span>
          </button>
        </div>
        <div class="sidebar-footer">
          <button id="btnLogout" class="logout-btn" type="button">
            <i class="lucide-log-out"></i> Logout
          </button>
        </div>
      </nav>
    </aside>

    <main class="app-main">
      <section id="welcomeBanner" class="welcome-banner hidden">
        <h2>Selamat datang, <span id="bannerRole"></span></h2>
        <p>Sistem Multi-Gudang (W1, W2, Istirahat, Bar, Kitchen).</p>
      </section>

      <section id="whDashboardSection" class="section">
        <h2>Dashboard Stok</h2>
        <p style="opacity:.8;margin-top:-6px;">Pantauan stok real-time.</p>

        <h4 style="margin:10px 0 5px; opacity:.7;">Gudang 1 (Utama)</h4>
        <div class="metric-row">
          <div id="cardW1Habis" class="metric-card red"><i class="lucide-x-circle"></i><div><b id="w1Habis">0</b> Habis</div></div>
          <div id="cardW1Lumayan" class="metric-card yellow"><i class="lucide-alert-triangle"></i><div><b id="w1Lumayan">0</b> Low &lt; 2</div></div>
          <div id="cardW1Banyak" class="metric-card green"><i class="lucide-check-circle"></i><div><b id="w1Banyak">0</b> Aman</div></div>
        </div>

        <h4 style="margin:15px 0 5px; opacity:.7;">Gudang Istirahat</h4>
        <div class="metric-row">
          <div id="cardRestHabis" class="metric-card red"><i class="lucide-x-circle"></i><div><b id="restHabis">0</b> Habis</div></div>
          <div id="cardRestLumayan" class="metric-card yellow"><i class="lucide-alert-triangle"></i><div><b id="restLumayan">0</b> Low &lt; 2</div></div>
          <div id="cardRestBanyak" class="metric-card green"><i class="lucide-check-circle"></i><div><b id="restBanyak">0</b> Aman</div></div>
        </div>

        <h4 style="margin:15px 0 5px; opacity:.7;">Gudang 2 (Kitchen/Transit)</h4>
        <div class="metric-row">
          <div id="cardW2Habis" class="metric-card red"><i class="lucide-x-circle"></i><div><b id="w2Habis">0</b> Habis</div></div>
          <div id="cardW2Lumayan" class="metric-card yellow"><i class="lucide-alert-triangle"></i><div><b id="w2Lumayan">0</b> Low &lt; 2</div></div>
          <div id="cardW2Banyak" class="metric-card green"><i class="lucide-check-circle"></i><div><b id="w2Banyak">0</b> Aman</div></div>
        </div>
        
        <h4 style="margin:15px 0 5px; opacity:.7;">Status Expired</h4>
        <div id="whExpiryWrap"></div>
      </section>

      <section id="whOpnameSection" class="section hidden">
        <h2>Manajemen Stok</h2>

        <div class="grid-2" style="gap:12px; margin:12px 0;">
          <div class="card glass" style="padding:12px;">
            <h3 style="margin:0 0 10px;">Tambah Master Item</h3>
            <label>Nama Item</label><input id="whItemName" type="text" placeholder="Contoh: Kopi Arabica">
            <div class="grid-2" style="gap:10px;">
              <div><label>Unit Besar</label><input id="whItemUnitBig" type="text" placeholder="Dus"></div>
              <div><label>Unit Kecil</label><input id="whItemUnitSmall" type="text" placeholder="Pcs"></div>
            </div>
            <div style="margin-bottom:10px;"><label>Isi/Dus</label><input id="whItemPackQty" type="number" min="0" placeholder="24"></div>

            <details style="background:rgba(0,0,0,0.03); border:1px solid var(--border); border-radius:8px; margin-bottom:10px;">
                <summary style="padding:10px; cursor:pointer; font-weight:600; color:var(--primary);">Klik Input Stok Awal</summary>
                <div style="padding:0 10px 10px;">
                    <div class="grid-2" style="gap:10px;">
                        <div><label>Stok W1 (Dus)</label><input id="whItemInitStockW1" type="number" min="0" placeholder="0"></div>
                        <div><label>Stok Istirahat (Dus)</label><input id="whItemInitStockRest" type="number" min="0" placeholder="0"></div>
                    </div>
                </div>
            </details>

            <div class="grid-2" style="gap:10px;">
              <div><label>Tgl Terima</label><input id="whItemReceivedAt" type="date"></div>
              <div><label>Supplier</label><input id="whItemSupplier" type="text"></div>
            </div>
            <label>EXP Date</label><input id="whItemExp" type="date">
            <label>Info (Catatan Audit)</label><textarea id="whItemInfo" rows="2" placeholder="Catatan khusus..."></textarea>
            <button id="btnSaveItem" class="btn-primary" type="button" style="margin-top:10px;">Simpan Item</button>
          </div>

          <div class="card glass" style="padding:12px;">
            <h3 style="margin:0 0 10px;">Transfer Stok</h3>
            <label>Cari Item</label><input id="moveSearch" type="text" placeholder="Ketik nama...">
            <label>Pilih Item</label><select id="moveItemSelect"></select>
            <label>Rute Transfer</label>
            <select id="transferType" style="font-weight:600; color:var(--primary);">
              <option value="w1_to_w2">Gudang 1 ➡ Gudang 2</option>
              <option value="w1_to_bar">Gudang 1 ➡ Bar</option>
              <option value="rest_to_bar">Gudang Istirahat ➡ Bar</option>
              <option value="w2_to_kitchen">Gudang 2 ➡ Kitchen</option>
            </select>
            <div class="grid-2" style="gap:10px;">
              <div><label>Jml Dus</label><input id="moveQtyPack" type="number" min="0"></div>
              <div><label>Jml Pcs</label><input id="moveQtyLoose" type="number" min="0"></div>
            </div>
            <div id="moveInfo" style="margin-top:8px; font-size:12px; color:var(--text-muted);"></div>
            <button id="btnMove" class="btn-secondary" type="button" style="margin-top:10px;">Proses Transfer</button>
            <hr style="margin:16px 0; opacity:.2;">
            
            <h3 style="margin:0 0 10px;">Tabel Stok</h3>
            <div class="grid-2" style="gap:10px;">
                <div>
                    <label>Lokasi</label>
                    <select id="whOpnameGudang">
                      <option value="w1">Gudang 1</option>
                      <option value="w2">Gudang 2</option>
                      <option value="rest">Istirahat</option>
                      <option value="bar">Bar</option>
                      <option value="kitchen">Kitchen</option>
                    </select>
                </div>
                <div><label>Cari</label><input id="whOpnameSearch" type="text" placeholder="..."></div>
            </div>
            <label style="display:flex; gap:8px; align-items:center; margin-top:10px;">
              <input id="whOpnameModeSmall" type="checkbox" style="width:auto;">
              <span style="font-size:13px;">Tampilkan Unit Kecil</span>
            </label>
          </div>
        </div>

        <div class="card glass" style="padding:12px;">
          <div style="overflow:auto;">
            <table class="table">
              <thead>
                <tr><th>Item</th><th>Spek</th><th>Lokasi</th><th>Sistem</th><th>Input Fisik</th><th style="text-align:right;">Aksi</th></tr>
              </thead>
              <tbody id="whOpnameTableBody"></tbody>
            </table>
          </div>
        </div>
      </section>

      <section id="whWasteSection" class="section hidden">
        <h2>Input Waste</h2>
        <div class="card glass" style="padding:12px; max-width:640px;">
          <label>Pilih Item</label><select id="wasteItemSelect"></select>
          <div class="grid-2" style="gap:10px;">
            <div><label>Tanggal</label><input id="wasteDate" type="date"></div>
            <div><label>Satuan</label><select id="wasteUnit"></select></div>
          </div>
          <label>Qty</label><input id="wasteQty" type="number" min="0">
          <label>Catatan</label><textarea id="wasteNote" rows="2"></textarea>
          <button id="btnSaveWaste" class="btn-primary" type="button" style="margin-top:10px;">Simpan Waste</button>
        </div>

        <div class="card glass" style="padding:12px; margin-top:16px;">
          <h3 style="margin:0 0 10px;">History Waste</h3>
          <div class="grid-2" style="gap:10px;">
            <div><label>Dari</label><input id="wasteFilterStart" type="date"></div>
            <div><label>Sampai</label><input id="wasteFilterEnd" type="date"></div>
          </div>
          <div style="overflow:auto; margin-top:10px;">
            <table class="table">
              <thead><tr><th>Tgl</th><th>Item</th><th>Qty</th><th>Satuan</th><th>Ket</th><th>Aksi</th></tr></thead>
              <tbody id="wasteHistoryBody"></tbody>
            </table>
          </div>
        </div>
      </section>

      <section id="whReportSection" class="section hidden">
        <h2>Laporan</h2>
        <div class="card glass wh-report-card" style="padding:12px; max-width:760px;">
          <div class="wh-report-grid" style="display:grid; gap:12px;">
            <div class="wh-report-field">
              <label>Tipe Laporan</label>
              <select id="whReportType" style="font-weight:600; color:var(--primary);">
                <option value="total_asset">Total Aset (Semua Gudang)</option>
                <option value="waste">Laporan Waste (Per Tanggal)</option>
                <option value="receiving">Barang Masuk</option>
              </select>
            </div>
            <div class="wh-week-preset" style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
              <button id="btnWeekThis" class="btn-secondary" type="button">Minggu Ini</button>
              <button id="btnWeekLast" class="btn-secondary" type="button">Minggu Lalu</button>
            </div>
            <div class="grid-2" style="gap:10px;">
              <div class="wh-report-field"><label>Mulai</label><input id="whReportStart" type="date"></div>
              <div class="wh-report-field"><label>Sampai</label><input id="whReportEnd" type="date"></div>
            </div>
            <div class="wh-report-actions" style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:10px;">
              <button id="btnWhReport" class="btn-primary" type="button">Generate</button>
              <button id="btnWhReportDownload" class="btn-secondary" type="button">Download CSV</button>
            </div>
          </div>
        </div>
        <div class="card glass wh-report-table" style="padding:12px; margin-top:12px;">
          <div class="table-wrap">
            <table class="table">
              <thead><tr id="whReportHead"></tr></thead>
              <tbody id="whReportBody"></tbody>
            </table>
          </div>
        </div>
      </section>

    </main>
  </div>

  <script src="script.js" type="module"></script>
  <script src="warehouse.js" type="module"></script>
</body>
</html>
