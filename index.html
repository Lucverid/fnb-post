<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>F&B POS — Modern v3</title>

  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#6a00ff" />

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lucide-static@latest/font/lucide.css">
  <link rel="stylesheet" href="style.css?v=3">

  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker
          .register('./service-worker.js')
          .then(reg => console.log('SW registered', reg.scope))
          .catch(err => console.error('SW registration failed', err));
      });
    }
  </script>
</head>

<body>

  <div id="toast-container"></div>

  <!-- AUTH -->
  <div id="auth-card" class="auth-card">
    <div class="auth-box">
      <h2>Login</h2>
      <label>Email</label>
      <input id="loginEmail" type="email">

      <label>Password</label>
      <input id="loginPassword" type="password">

      <button id="btnLogin" class="btn-primary" type="button">Login</button>

      <hr>

      <h2>Register</h2>
      <label>Email</label>
      <input id="registerEmail" type="email">

      <label>Password</label>
      <input id="registerPassword" type="password">

      <label>Role</label>
      <select id="registerRole">
        <option value="admin">Admin</option>
        <option value="kasir">Kasir</option>
      </select>

      <button id="btnRegister" class="btn-secondary" type="button">Daftar Baru</button>
    </div>
  </div>

  <!-- APP -->
  <div id="app-shell" class="app-shell hidden">

    <header class="app-header glass">
      <div class="header-left">
        <div class="logo">F&amp;B</div>
        <div class="user-info">
          <div id="topbarEmail">–</div>
          <div id="connectionStatus" class="connection">Offline</div>
        </div>
      </div>

      <div class="header-right">
        <div id="notifBtn" class="notif-btn">
          <i class="lucide-bell"></i>
          <span id="notifBadge" class="notif-count">0</span>
        </div>

        <div id="notifPanel" class="notif-panel hidden">
          <div class="notif-title">Notifikasi</div>
          <ul id="notifList"></ul>
        </div>

        <button id="burgerBtn" class="burger-btn" type="button">
          <span></span><span></span><span></span>
        </button>
      </div>
    </header>

    <!-- SIDEBAR -->
    <aside id="sidebar" class="sidebar">
      <nav>
        <div class="sidebar-group">

          <div style="margin:10px 0 6px; font-size:12px; opacity:.7;">WAREHOUSE</div>

          <!-- ✅ HAPUS admin-only biar bisa di klik semua user -->
          <button id="navWhDashboard" class="side-item active" type="button" data-wh-nav="1">
            <i class="lucide-layout-dashboard"></i> <span>Dashboard Opname</span>
          </button>

          <button id="navWhOpname" class="side-item" type="button" data-wh-nav="1">
            <i class="lucide-clipboard-list"></i> <span>Halaman Opname</span>
          </button>

          <button id="navWhWaste" class="side-item" type="button" data-wh-nav="1">
            <i class="lucide-trash-2"></i> <span>Waste</span>
          </button>

          <button id="navWhReport" class="side-item" type="button" data-wh-nav="1">
            <i class="lucide-file-text"></i> <span>Laporan (Gudang/Waste)</span>
          </button>

          <hr style="margin:12px 0; opacity:.2;">

          <!-- MENU LAMA (biarkan kalau mau, tapi memang kamu disable di JS) -->
          <button class="side-item admin-only" data-section="dashboard" type="button">
            <i class="lucide-bar-chart"></i> <span>Dashboard (Lama)</span>
          </button>

          <button class="side-item" data-section="sales" type="button">
            <i class="lucide-shopping-cart"></i> <span>Kasir (Lama)</span>
          </button>

          <button class="side-item admin-only" data-section="inventory" type="button">
            <i class="lucide-box"></i> <span>Inventory (Lama)</span>
          </button>

          <button class="side-item admin-only" data-section="recipe" type="button">
            <i class="lucide-utensils"></i> <span>Resep (Lama)</span>
          </button>

          <button class="side-item admin-only" data-section="opname" type="button">
            <i class="lucide-clipboard-list"></i> <span>Opname (Lama)</span>
          </button>

          <button class="side-item admin-only" data-section="reports" type="button">
            <i class="lucide-file-text"></i> <span>Laporan (Lama)</span>
          </button>

        </div>

        <div class="sidebar-footer">
          <button id="btnLogout" class="logout-btn" type="button">
            <i class="lucide-log-out"></i> Logout
          </button>
        </div>
      </nav>
    </aside>

    <!-- MAIN -->
    <main class="app-main">

      <section id="welcomeBanner" class="welcome-banner hidden">
        <h2>Selamat datang, <span id="bannerRole"></span></h2>
        <p>Akses cepat POS, inventory, dashboard, dan laporan.</p>
      </section>

      <!-- ===================== WAREHOUSE ===================== -->
      <section id="whDashboardSection" class="section">
        <h2>Dashboard Opname</h2>
        <p style="opacity:.8;margin-top:-6px;">Klik indikator untuk filter otomatis ke <b>Halaman Opname</b>.</p>

        <div class="metric-row">
          <div id="cardW1Habis" class="metric-card red">
            <i class="lucide-x-circle"></i>
            <div><b id="w1Habis">0</b> Habis (Gudang 1)</div>
          </div>
          <div id="cardW1Lumayan" class="metric-card yellow">
            <i class="lucide-alert-triangle"></i>
            <div><b id="w1Lumayan">0</b> Lumayan Banyak &lt; 10 (Gudang 1)</div>
          </div>
          <div id="cardW1Banyak" class="metric-card green">
            <i class="lucide-check-circle"></i>
            <div><b id="w1Banyak">0</b> Banyak &gt; 50 (Gudang 1)</div>
          </div>
        </div>

        <div class="metric-row">
          <div id="cardW2Habis" class="metric-card red">
            <i class="lucide-x-circle"></i>
            <div><b id="w2Habis">0</b> Habis (Gudang 2)</div>
          </div>
          <div id="cardW2Lumayan" class="metric-card yellow">
            <i class="lucide-alert-triangle"></i>
            <div><b id="w2Lumayan">0</b> Lumayan Banyak &lt; 10 (Gudang 2)</div>
          </div>
          <div id="cardW2Banyak" class="metric-card green">
            <i class="lucide-check-circle"></i>
            <div><b id="w2Banyak">0</b> Banyak &gt; 50 (Gudang 2)</div>
          </div>
        </div>
      </section>

      <!-- ===================== WAREHOUSE OPNAME ===================== -->
      <section id="whOpnameSection" class="section hidden">
        <h2>Halaman Opname</h2>

        <!-- MASTER ITEM -->
        <div class="card glass" style="margin-top:12px;">
          <div style="display:flex;gap:12px;flex-wrap:wrap;align-items:flex-end;">
            <div style="flex:1;min-width:180px;">
              <label>Nama Item</label>
              <input id="whItemName" type="text" placeholder="Contoh: Tepung Terigu">
            </div>

            <!-- legacy (biar sesuai warehouse.js yang fallback ke whItemUnit) -->
            <div style="width:140px;">
              <label>Unit Dus (legacy)</label>
              <input id="whItemUnit" type="text" placeholder="dus">
            </div>

            <!-- field baru (opsional, tapi warehouse.js sudah siap) -->
            <div style="width:140px;">
              <label>Unit Besar</label>
              <input id="whItemUnitBig" type="text" placeholder="dus">
            </div>
            <div style="width:140px;">
              <label>Unit Isi</label>
              <input id="whItemUnitSmall" type="text" placeholder="pcs/ml/gram">
            </div>
            <div style="width:160px;">
              <label>Isi per Dus</label>
              <input id="whItemPackQty" type="number" min="0" step="1" placeholder="cth 12">
            </div>
            <div style="width:180px;">
              <label>Harga / Dus (Supplier)</label>
              <input id="whItemPricePerPack" type="number" min="0" step="1" placeholder="cth 250000">
            </div>

            <div style="width:160px;">
              <label>EXP Date</label>
              <input id="whItemExp" type="date">
            </div>

            <div style="width:160px;">
              <label>Tanggal Masuk</label>
              <input id="whItemReceivedAt" type="date">
            </div>

            <div style="flex:1;min-width:200px;">
              <label>Supplier</label>
              <input id="whItemSupplier" type="text" placeholder="Nama supplier">
            </div>

            <div style="flex:2;min-width:240px;">
              <label>Info</label>
              <input id="whItemInfo" type="text" placeholder="Catatan (opsional)">
            </div>

            <div>
              <button id="btnSaveItem" class="btn-primary" type="button">Simpan Item</button>
            </div>
          </div>
        </div>

        <!-- FILTER + TABLE -->
        <div class="card glass" style="margin-top:14px;">
          <div style="display:flex;gap:12px;flex-wrap:wrap;align-items:flex-end;">
            <div style="width:180px;">
              <label>Pilih Gudang</label>
              <select id="whOpnameGudang">
                <option value="w1">Gudang 1</option>
                <option value="w2">Gudang 2</option>
              </select>
            </div>
            <div style="flex:1;min-width:220px;">
              <label>Cari Item</label>
              <input id="whOpnameSearch" type="text" placeholder="Cari nama/supplier/unit...">
            </div>
          </div>

          <div style="overflow:auto;margin-top:12px;">
            <table class="table">
              <thead>
                <tr>
                  <th>Item</th>
                  <th>Unit</th>
                  <th>EXP</th>
                  <th>Info</th>
                  <th>Masuk</th>
                  <th>Supplier</th>
                  <th>Stok Sistem</th>
                  <th>Stok Fisik</th>
                  <th>Aksi</th>
                </tr>
              </thead>
              <tbody id="whOpnameTableBody">
                <tr><td colspan="9">Memuat...</td></tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- TRANSFER -->
        <div class="card glass" style="margin-top:14px;">
          <h3 style="margin:0 0 10px;">Transfer Gudang 1 → Gudang 2</h3>
          <div style="display:flex;gap:12px;flex-wrap:wrap;align-items:flex-end;">
            <div style="flex:1;min-width:240px;">
              <label>Pilih Item</label>
              <select id="moveItemSelect"></select>
            </div>
            <div style="width:160px;">
              <label>Qty (dus)</label>
              <input id="moveQty" type="number" min="0" step="1" placeholder="cth 2">
            </div>
            <div>
              <button id="btnMove" class="btn-secondary" type="button">Transfer</button>
            </div>
          </div>
          <div style="font-size:12px;opacity:.7;margin-top:8px;">
            * Qty transfer memakai unit besar (dus). Kalau mau unit kecil, nanti kita bikin konversi dari packQty.
          </div>
        </div>
      </section>

      <!-- ===================== WAREHOUSE WASTE ===================== -->
      <section id="whWasteSection" class="section hidden">
        <h2>Waste</h2>

        <div class="card glass" style="margin-top:12px;">
          <div style="display:flex;gap:12px;flex-wrap:wrap;align-items:flex-end;">
            <div style="flex:1;min-width:220px;">
              <label>Search Item (opsional)</label>
              <input id="wasteItemSearch" type="text" placeholder="Ketik nama item...">
            </div>

            <div style="flex:1;min-width:240px;">
              <label>Pilih Item</label>
              <select id="wasteItemSelect"></select>
            </div>

            <div style="width:170px;">
              <label>Tanggal</label>
              <input id="wasteDate" type="date">
            </div>

            <div style="width:150px;">
              <label>Qty</label>
              <input id="wasteQty" type="number" min="0" step="0.01" placeholder="cth 250">
            </div>

            <div style="width:140px;">
              <label>Satuan</label>
              <select id="wasteUnit"></select>
            </div>

            <div style="flex:2;min-width:240px;">
              <label>Catatan</label>
              <input id="wasteNote" type="text" placeholder="Alasan waste...">
            </div>

            <div>
              <button id="btnSaveWaste" class="btn-primary" type="button">Simpan Waste</button>
            </div>
          </div>

          <div style="font-size:12px;opacity:.7;margin-top:10px;">
            * Waste tidak mengurangi stok gudang (sesuai warehouse.js kamu). Kalau mau nanti, kita bisa bikin opsi “kurangi stok W1/W2”.
          </div>
        </div>
      </section>

      <!-- ===================== WAREHOUSE REPORT ===================== -->
      <section id="whReportSection" class="section hidden">
        <h2>Laporan Warehouse</h2>

        <div class="card glass" style="margin-top:12px;">
          <div style="display:flex;gap:12px;flex-wrap:wrap;align-items:flex-end;">
            <div style="width:220px;">
              <label>Jenis Laporan</label>
              <select id="whReportType">
                <option value="opname_w1">Opname Gudang 1</option>
                <option value="opname_w2">Opname Gudang 2</option>
                <option value="waste_w1">Waste</option>
                <option value="waste_w2">Waste</option>
              </select>
            </div>

            <div style="width:170px;">
              <label>Tanggal Mulai</label>
              <input id="whReportStart" type="date">
            </div>

            <div style="width:170px;">
              <label>Tanggal Akhir</label>
              <input id="whReportEnd" type="date">
            </div>

            <div>
              <button id="btnWhReport" class="btn-primary" type="button">Generate</button>
            </div>
          </div>

          <div style="overflow:auto;margin-top:12px;">
            <table class="table">
              <thead id="whReportHead"></thead>
              <tbody id="whReportBody">
                <tr><td>Silakan generate laporan.</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- SECTION LAMA (boleh tetap ada) -->
      <section id="salesSection" class="section hidden"></section>
      <section id="inventorySection" class="section hidden"></section>
      <section id="recipeSection" class="section hidden"></section>
      <section id="dashboardSection" class="section hidden"></section>
      <section id="opnameSection" class="section hidden"></section>
      <section id="reportsSection" class="section hidden"></section>

      <div id="bomModal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-card">
          <div class="modal-header">
            <h3 id="bomModalTitle">Detail BOM</h3>
            <button id="bomModalClose" class="btn-icon-close" type="button">&times;</button>
          </div>
          <div id="bomModalBody" class="modal-body"></div>
        </div>
      </div>

    </main>
  </div>

  <script src="script.js" type="module"></script>
  <script src="warehouse.js" type="module"></script>
</body>
</html>